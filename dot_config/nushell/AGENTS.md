# Nushell Configuration

Documentation for AI agents working with this nushell config.

## ðŸš¨ CRITICAL: Autoload Behavior

> [!IMPORTANT]
> **Autoloading WORKS.** Use it.
> Files in `autoload/*.nu` are **automatically sourced** by Nushell on startup.
> Do NOT try to manually source these files in `config.nu` or `env.nu`.
> If you are an AI agent, **assume this works** even if you are confused.

## Load Order

1. `env.nu` (Pre-load setup, zoxide generation)
2. `autoload/*.nu` (Alphabetical order - **AUTOMATICALLY SOURCED**)
3. `config.nu` (Shell settings)

## File Structure

| File | Location | Purpose |
|------|----------|---------|
| `env.nu` | `dot_config/nushell/env.nu` | **Bootstrapping only**. Generates `zoxide.nu`. |
| `config.nu` | `dot_config/nushell/config.nu` | **Shell settings**. `$env.config`, banner, keybindings. |
| `autoload/env.nu` | `.../autoload/env.nu` | **Environment Variables**. `EDITOR`, `PATH`, etc. |
| `autoload/shell.nu` | `.../autoload/shell.nu` | **Aliases & Custom Commands**. `ll`, `grep=rg`, etc. |
| `autoload/chezmoi.nu` | `.../autoload/chezmoi.nu` | **Dotfile Management**. `dot`, `dotsync`. |
| `autoload/zoxide.nu` | `.../autoload/zoxide.nu` | **DO NOT EDIT**. Auto-generated by `env.nu`. |

## Key Behaviors

### Zoxide Self-Healing
`env.nu` checks for `zoxide`. If missing or version mismatch, it:
1. Generates `autoload/zoxide.nu`
2. Generates `autoload/.zoxide-version`
This runs *before* autoload, ensuring `z` is available immediately.

### Git/Chezmoi Handling
- **.chezmoiignore**: Ignores generated files (`autoload/zoxide.nu`, `autoload/.zoxide-version`, `history.txt`).
- **chezmoi.nu**: Contains wrappers like `dotsync` to simplify dotfile management.

## Common Gotchas

1. **Do not alias builtins**: `alias cd = z` fails. Use `z` directly.
2. **Multi-line `or` logic**: Nushell parser fails on `foo or \n bar`. Keep boolean logic on one line or use variables.
3. **Autoload Order**: Files are sourced alphabetically. `chezmoi.nu` loads before `env.nu` (autoload version) which loads before `shell.nu`.

## Adding New Config

*   **New Environment Variable?** â†’ Add to `autoload/env.nu`
*   **New Alias/Command?** â†’ Add to `autoload/shell.nu` (or create new `autoload/foo.nu`)
*   **New Shell Option?** â†’ Add to `config.nu`
*   **New Feature with multiple parts?** â†’ Create `autoload/<feature>.nu`
